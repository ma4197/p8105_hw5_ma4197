---
title: "Homework 5"
author: "Mayuri Albal"
date: "2022-11-10"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(rvest)
library(ggplot2)
```

```{r}
twp_data = read_csv(file= "./data/homicide-data.csv") %>%
janitor::clean_names()
```

**Describe the Raw Data**
Within the original data set there are 52,719 observations and 12 variables. The variables names include: 'uid', 'reported_date', 'victim_last', 'victim_first', 'victim_race', 'victim_age', 'victim_sex', 'city', 'state', 'lat', 'lon', and 'disposition'. This data was collected across different police department reports from 50 of the largest cities in the United States from the past decade.

City and State Variable Made
```{r}
murder_df=
twp_data %>%
janitor::clean_names() %>% 
mutate(
  state= replace(state, state == "AL", "OK"),
  state = replace(state, state== "wI", "WI")
) %>% 
mutate(
  city_state= paste(city, state, sep= ","))


```

Solved and Unsolved Case Count
```{r}
case_count= 
murder_df %>% 
  group_by(city_state) %>% 
  summarize(unsolved_n = sum(disposition== 'Closed without arrest',
                             disposition == 'Open/No arrest'),
                          total_m= n()) 
```

Prop.Test for Baltimore
```{r}
baltimore.test=
  case_count %>% 
  filter(city_state == "Baltimore,MD") %>% 
  transform(
    prop = map2(unsolved_n, total_m, ~prop.test(.x, .y) %>% 
      broom::tidy())) %>% 
    unnest() %>% 
  select(prop.estimate, prop.conf.low, prop.conf.high)
```

Prop.test All Cities
```{r}
all_cities = 
case_count %>% 
  mutate(
    prop= map2(unsolved_n, total_m, ~prop.test(.x, .y) %>% 
      broom::tidy())) %>% 
    unnest() %>% 
  select(city_state, estimate, conf.low, conf.high)

all_cities_output=
  all_cities %>% 
  knitr::kable() 
  
```

Plotting

```{r}
ggplot(all_cities, aes(x= reorder(city_state,estimate), y= estimate, color=city_state))+
  geom_point()+
  geom_errorbar(aes(ymin=conf.low, ymax= conf.high))+
  theme_classic()+ 
  theme(legend.position= "none")+
  ggtitle("Proportion Estimated of Unsolved Homicide in Large US Cities")+
  theme(plot.title = element_text(hjust= 0.5),
        axis.text.x.bottom = element_text(size= 7, angle= 90))+
    labs(x = "City",
        y= "Estimate of Proportion")
  
```
*Description*
The estimated proportions of unsolved homicides for each of the 50 largest cities in the US were graphed in order of lowest to highest proportion of unsolved cases. Richmond, VA has the lowest proportion, whilst Chicago, IL has the highest. Each was fitted with a error bar based upon the lowest and highest values from the estimates 95% confidence interval generated.

## Problem 3

Simulation #1
```{r}
simulate_prob3 = function(n = 30, mu=0, sigma = 5) {
  simulate_data =
  tibble(
    x = list(rnorm(n, mean = mu, sd = sigma)))
  
  return(simulate_data)}
  
output = tibble()
  for (i in 1:5000) {
    output = bind_rows(output,simulate_prob3(mu=0)) 
  }

ttest_output= output %>% 
  mutate(
    t_test_new = map(.x = x, ~t.test(.x) %>% broom::tidy())) %>% 
  unnest(t_test_new) %>% 
  select(x,estimate,p.value)
```


Simulation #2 with (1-6)
```{r}
simulate2 = function(n = 30, mu=0, sigma = 5) {
  simulate2_data =
  tibble(
    x = rnorm(n, mean = mu, sd = sigma))

simulate2_data %>% 
  t.test() %>% 
  broom::tidy()}
```

```{r}
mu_list=
  list(
    "mu = 1" = 1,
    "mu = 2" = 2,
    "mu = 3" = 3,
    "mu = 4" = 4,
    "mu = 5" = 5,
    "mu = 6" = 6
  )
mu_output= list(vector, length = 6)


for (i in 1:6) {
  mu_output[[i]] = rerun(5000, simulate2(mu = mu_list[[i]])) %>% 
    bind_rows()
}
```


```{r}
mu_output= tibble(mu_output)

mu = c(1,2,3,4,5,6)
mu_output ['mu']= mu
```

```{r}
mu_output_final=
  unnest(mu_output)
```

##Plots

```{r}
mu_output_final %>% 
  mutate(
    rnull= ifelse(p.value < 0.05, 1, 0)) %>% 
  count(power= mean(rnull))
  
```

